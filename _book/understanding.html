<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2 Understanding | DAM AT1-A</title>
  <meta name="description" content="2 Understanding | DAM AT1-A" />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="2 Understanding | DAM AT1-A" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2 Understanding | DAM AT1-A" />
  
  
  

<meta name="author" content="Joshua McCarthy" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="data-cleaning.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Planning</a></li>
<li class="chapter" data-level="2" data-path="understanding.html"><a href="understanding.html"><i class="fa fa-check"></i><b>2</b> Understanding</a><ul>
<li class="chapter" data-level="2.1" data-path="understanding.html"><a href="understanding.html#initial-import-and-data-prep"><i class="fa fa-check"></i><b>2.1</b> Initial Import and Data Prep</a></li>
<li class="chapter" data-level="2.2" data-path="understanding.html"><a href="understanding.html#data-quality"><i class="fa fa-check"></i><b>2.2</b> Data Quality</a></li>
<li class="chapter" data-level="2.3" data-path="understanding.html"><a href="understanding.html#initial-understanding"><i class="fa fa-check"></i><b>2.3</b> Initial Understanding</a><ul>
<li class="chapter" data-level="2.3.1" data-path="understanding.html"><a href="understanding.html#customers"><i class="fa fa-check"></i><b>2.3.1</b> Customers</a></li>
<li class="chapter" data-level="2.3.2" data-path="understanding.html"><a href="understanding.html#industry"><i class="fa fa-check"></i><b>2.3.2</b> Industry</a></li>
<li class="chapter" data-level="2.3.3" data-path="understanding.html"><a href="understanding.html#industry-6"><i class="fa fa-check"></i><b>2.3.3</b> Industry 6</a></li>
<li class="chapter" data-level="2.3.4" data-path="understanding.html"><a href="understanding.html#industry-10"><i class="fa fa-check"></i><b>2.3.4</b> Industry 10</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="understanding.html"><a href="understanding.html#monthly-amount"><i class="fa fa-check"></i><b>2.4</b> Monthly Amount</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="data-cleaning.html"><a href="data-cleaning.html"><i class="fa fa-check"></i><b>3</b> Data Cleaning</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">DAM AT1-A</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="understanding" class="section level1">
<h1><span class="header-section-number">2</span> Understanding</h1>
<div id="initial-import-and-data-prep" class="section level2">
<h2><span class="header-section-number">2.1</span> Initial Import and Data Prep</h2>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="co"># import dataset</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="co">#list of common NA substitution terms</span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="co"># 0 is not included intentionally</span></a>
<a class="sourceLine" id="cb5-4" data-line-number="4">pot_nas &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;&quot;</span>, <span class="st">&quot; &quot;</span>, <span class="st">&quot;  &quot;</span>, <span class="st">&quot;.&quot;</span>, <span class="st">&quot;,&quot;</span>, <span class="st">&quot;NaN&quot;</span>, <span class="st">&quot;NAN&quot;</span>, <span class="st">&quot;nan&quot;</span>, <span class="st">&quot;NA&quot;</span>, <span class="st">&quot;na&quot;</span>, <span class="st">&quot;N/A&quot;</span>, <span class="st">&quot;n/a&quot;</span>)</a>
<a class="sourceLine" id="cb5-5" data-line-number="5"></a>
<a class="sourceLine" id="cb5-6" data-line-number="6"><span class="co"># To make checking for missing values, including the read_csv(,na) argument allows us to assign all missing values defined in pot_nas as NA </span></a>
<a class="sourceLine" id="cb5-7" data-line-number="7">transactions &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;./core_data/transactions.csv&quot;</span>, <span class="dt">na =</span> pot_nas)</a></code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   date = col_character(),
##   customer_id = col_character(),
##   industry = col_double(),
##   location = col_double(),
##   monthly_amount = col_double()
## )</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="co"># check names match dictionary</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="kw">names</span>(transactions)</a></code></pre></div>
<pre><code>## [1] &quot;date&quot;           &quot;customer_id&quot;    &quot;industry&quot;       &quot;location&quot;      
## [5] &quot;monthly_amount&quot;</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="co"># rename date to trdate due to potential issues with R date function</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2">tname &lt;-<span class="st"> </span><span class="kw">names</span>(transactions)</a>
<a class="sourceLine" id="cb9-3" data-line-number="3">tname[<span class="dv">1</span>] &lt;-<span class="st"> &quot;trdate&quot;</span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4"><span class="kw">names</span>(transactions) &lt;-<span class="st"> </span>tname</a>
<a class="sourceLine" id="cb9-5" data-line-number="5"></a>
<a class="sourceLine" id="cb9-6" data-line-number="6"><span class="co">#check for NA values</span></a>
<a class="sourceLine" id="cb9-7" data-line-number="7"><span class="cf">if</span> (<span class="kw">nrow</span>(transactions) <span class="op">==</span><span class="st"> </span><span class="kw">nrow</span>(<span class="kw">na.omit</span>(transactions))){</a>
<a class="sourceLine" id="cb9-8" data-line-number="8">  <span class="kw">print</span>(<span class="st">&quot;no missing values&quot;</span>)</a>
<a class="sourceLine" id="cb9-9" data-line-number="9">} <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb9-10" data-line-number="10">  <span class="kw">print</span>(<span class="st">&quot;missing values present&quot;</span>)</a>
<a class="sourceLine" id="cb9-11" data-line-number="11">}</a></code></pre></div>
<pre><code>## [1] &quot;no missing values&quot;</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="co">#data does not appear to have any missing values</span></a>
<a class="sourceLine" id="cb11-2" data-line-number="2"></a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="co"># check data structure</span></a>
<a class="sourceLine" id="cb11-4" data-line-number="4"><span class="kw">str</span>(transactions)</a></code></pre></div>
<pre><code>## Classes &#39;spec_tbl_df&#39;, &#39;tbl_df&#39;, &#39;tbl&#39; and &#39;data.frame&#39;: 94248 obs. of  5 variables:
##  $ trdate        : chr  &quot;1/1/13&quot; &quot;1/2/13&quot; &quot;1/3/13&quot; &quot;1/4/13&quot; ...
##  $ customer_id   : chr  &quot;70efdf2ec9b086079795c442636b55fb&quot; &quot;70efdf2ec9b086079795c442636b55fb&quot; &quot;70efdf2ec9b086079795c442636b55fb&quot; &quot;70efdf2ec9b086079795c442636b55fb&quot; ...
##  $ industry      : num  8 8 8 8 8 8 8 8 8 8 ...
##  $ location      : num  9 9 9 9 9 9 9 9 9 9 ...
##  $ monthly_amount: num  753851 651548 1138769 659739 770675 ...
##  - attr(*, &quot;spec&quot;)=
##   .. cols(
##   ..   date = col_character(),
##   ..   customer_id = col_character(),
##   ..   industry = col_double(),
##   ..   location = col_double(),
##   ..   monthly_amount = col_double()
##   .. )</code></pre>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="co"># date variable not returned in date format</span></a>
<a class="sourceLine" id="cb13-2" data-line-number="2">transactions<span class="op">$</span>trdate &lt;-<span class="st"> </span><span class="kw">as.Date</span>(transactions<span class="op">$</span>trdate, <span class="dt">format =</span> <span class="st">&quot;%d/%m/%y&quot;</span>)</a>
<a class="sourceLine" id="cb13-3" data-line-number="3"></a>
<a class="sourceLine" id="cb13-4" data-line-number="4"><span class="co"># update industry, customer and location as they are all factors</span></a>
<a class="sourceLine" id="cb13-5" data-line-number="5">transactions<span class="op">$</span>customer_id &lt;-<span class="st"> </span><span class="kw">as.factor</span>(transactions<span class="op">$</span>customer_id)</a>
<a class="sourceLine" id="cb13-6" data-line-number="6">transactions<span class="op">$</span>industry &lt;-<span class="st"> </span><span class="kw">as.factor</span>(transactions<span class="op">$</span>industry)</a>
<a class="sourceLine" id="cb13-7" data-line-number="7">transactions<span class="op">$</span>location &lt;-<span class="st"> </span><span class="kw">as.factor</span>(transactions<span class="op">$</span>location)</a>
<a class="sourceLine" id="cb13-8" data-line-number="8"></a>
<a class="sourceLine" id="cb13-9" data-line-number="9"><span class="co"># double check formatting</span></a>
<a class="sourceLine" id="cb13-10" data-line-number="10"><span class="kw">str</span>(transactions)</a></code></pre></div>
<pre><code>## Classes &#39;spec_tbl_df&#39;, &#39;tbl_df&#39;, &#39;tbl&#39; and &#39;data.frame&#39;: 94248 obs. of  5 variables:
##  $ trdate        : Date, format: &quot;2013-01-01&quot; &quot;2013-02-01&quot; ...
##  $ customer_id   : Factor w/ 4464 levels &quot;000a91f3e374e6147d58ed1814247508&quot;,..: 1970 1970 1970 1970 1970 1970 1970 1970 1970 1970 ...
##  $ industry      : Factor w/ 10 levels &quot;1&quot;,&quot;2&quot;,&quot;3&quot;,&quot;4&quot;,..: 8 8 8 8 8 8 8 8 8 8 ...
##  $ location      : Factor w/ 10 levels &quot;1&quot;,&quot;2&quot;,&quot;3&quot;,&quot;4&quot;,..: 9 9 9 9 9 9 9 9 9 9 ...
##  $ monthly_amount: num  753851 651548 1138769 659739 770675 ...
##  - attr(*, &quot;spec&quot;)=
##   .. cols(
##   ..   date = col_character(),
##   ..   customer_id = col_character(),
##   ..   industry = col_double(),
##   ..   location = col_double(),
##   ..   monthly_amount = col_double()
##   .. )</code></pre>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="kw">summary</span>(transactions)</a></code></pre></div>
<pre><code>##      trdate                                     customer_id       industry    
##  Min.   :2013-01-01   0023a1e3447fdb31836536cc903f1310:   47   1      :44901  
##  1st Qu.:2014-05-01   006c64491cb8acf2092ce0e0341797fe:   47   2      :22043  
##  Median :2015-06-01   0079e3e6d496ad07cee7fd63d3d7c9b2:   47   3      : 8336  
##  Mean   :2015-03-26   00989c20ff1386dc386d8124ebcba1a5:   47   4      : 5896  
##  3rd Qu.:2016-03-01   00bbd6beace7365b27a913db75fddce9:   47   7      : 3912  
##  Max.   :2016-11-01   01882513d5fa7c329e940dda99b12147:   47   5      : 3341  
##                       (Other)                         :93966   (Other): 5819  
##     location     monthly_amount     
##  2      :21410   Min.   :        0  
##  1      :17660   1st Qu.:    95323  
##  5      : 9703   Median :   179399  
##  4      : 9351   Mean   :   395397  
##  6      : 7446   3rd Qu.:   375439  
##  7      : 7317   Max.   :100000000  
##  (Other):21361</code></pre>
<p>The summary shows;
* Date range from Jan 2013 to Dec 2016
* 4464 unique customers
* All 10 locations and industries are represtened
* There is a disproportionate number of transactions in industires 1 &amp; 2
* There is a disproportionate number of transactions in locations 1 &amp; 2
* The monthly transaction amounts range from 0 - 100M
** The mean is 395396 and median is 179399, low considering the range</p>
</div>
<div id="data-quality" class="section level2">
<h2><span class="header-section-number">2.2</span> Data Quality</h2>
</div>
<div id="initial-understanding" class="section level2">
<h2><span class="header-section-number">2.3</span> Initial Understanding</h2>
<div id="customers" class="section level3">
<h3><span class="header-section-number">2.3.1</span> Customers</h3>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="co"># Do all customer have equal numbers of transactions?</span></a>
<a class="sourceLine" id="cb17-2" data-line-number="2"></a>
<a class="sourceLine" id="cb17-3" data-line-number="3"><span class="co">## counts transactions by customer_id, formats as a table</span></a>
<a class="sourceLine" id="cb17-4" data-line-number="4">number_of_transactions_per_customer &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">table</span>(transactions<span class="op">$</span>customer_id))</a>
<a class="sourceLine" id="cb17-5" data-line-number="5"><span class="kw">summary</span>(number_of_transactions_per_customer)</a></code></pre></div>
<pre><code>##                                Var1           Freq      
##  000a91f3e374e6147d58ed1814247508:   1   Min.   : 1.00  
##  0014fcb3db4c8459d26309b177005b10:   1   1st Qu.: 8.00  
##  0023a1e3447fdb31836536cc903f1310:   1   Median :18.00  
##  0023daa5a44ef6fbe42379f24e00254c:   1   Mean   :21.11  
##  0029f088c57ad3b6ec589f9ba4f7a057:   1   3rd Qu.:33.00  
##  003af5a042e00ac9b489153a81d676ca:   1   Max.   :47.00  
##  (Other)                         :4458</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="co"># Answer - No</span></a>
<a class="sourceLine" id="cb19-2" data-line-number="2"></a>
<a class="sourceLine" id="cb19-3" data-line-number="3"><span class="co"># Do any customers have duplicate transactions on the same date?</span></a>
<a class="sourceLine" id="cb19-4" data-line-number="4"></a>
<a class="sourceLine" id="cb19-5" data-line-number="5"><span class="co">## creates a dataframe of the trdate and customer_id columns</span></a>
<a class="sourceLine" id="cb19-6" data-line-number="6">duplicate_check &lt;-<span class="st"> </span>transactions <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb19-7" data-line-number="7"><span class="st">  </span><span class="kw">select</span>(trdate, customer_id)</a>
<a class="sourceLine" id="cb19-8" data-line-number="8"></a>
<a class="sourceLine" id="cb19-9" data-line-number="9"><span class="co">## appends a column to the dataframe if there is a duplicate transaction</span></a>
<a class="sourceLine" id="cb19-10" data-line-number="10">duplicate_check<span class="op">$</span>dup &lt;-<span class="st"> </span>transactions <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb19-11" data-line-number="11"><span class="st">  </span><span class="kw">select</span>(trdate, customer_id) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb19-12" data-line-number="12"><span class="st">  </span><span class="kw">duplicated</span>()</a>
<a class="sourceLine" id="cb19-13" data-line-number="13"></a>
<a class="sourceLine" id="cb19-14" data-line-number="14"><span class="co">## creates a table of rows that are duplicates</span></a>
<a class="sourceLine" id="cb19-15" data-line-number="15">dup_check_sum &lt;-<span class="st"> </span>duplicate_check <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb19-16" data-line-number="16"><span class="st">  </span><span class="kw">filter</span>(duplicate_check<span class="op">$</span>dup <span class="op">==</span><span class="st"> &quot;TRUE&quot;</span>)</a>
<a class="sourceLine" id="cb19-17" data-line-number="17"></a>
<a class="sourceLine" id="cb19-18" data-line-number="18"><span class="co">## if there are no entries, therefore no duplicates in the new table prints &quot;no duplicates</span></a>
<a class="sourceLine" id="cb19-19" data-line-number="19"><span class="cf">if</span> (<span class="kw">nrow</span>(dup_check_sum) <span class="op">==</span><span class="st"> </span><span class="dv">0</span>){</a>
<a class="sourceLine" id="cb19-20" data-line-number="20">  <span class="kw">print</span> (<span class="st">&quot;No duplicates&quot;</span>)</a>
<a class="sourceLine" id="cb19-21" data-line-number="21">} <span class="cf">else</span>{</a>
<a class="sourceLine" id="cb19-22" data-line-number="22">  <span class="kw">print</span>(<span class="st">&quot;Yes duplicates&quot;</span>)</a>
<a class="sourceLine" id="cb19-23" data-line-number="23">}</a></code></pre></div>
<pre><code>## [1] &quot;No duplicates&quot;</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1"><span class="co"># Answer - No</span></a>
<a class="sourceLine" id="cb21-2" data-line-number="2"></a>
<a class="sourceLine" id="cb21-3" data-line-number="3"><span class="co"># Do any customers operate across industries?</span></a>
<a class="sourceLine" id="cb21-4" data-line-number="4"></a>
<a class="sourceLine" id="cb21-5" data-line-number="5"><span class="co">## selects the columns customer_id and industry and then writes unique entries to dataframe</span></a>
<a class="sourceLine" id="cb21-6" data-line-number="6">industry_check &lt;-<span class="st"> </span>transactions <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb21-7" data-line-number="7"><span class="st">  </span><span class="kw">select</span>(industry, customer_id) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb21-8" data-line-number="8"><span class="st">  </span><span class="kw">distinct</span>()</a>
<a class="sourceLine" id="cb21-9" data-line-number="9"></a>
<a class="sourceLine" id="cb21-10" data-line-number="10"><span class="co">## selects only the customer id and checks for duplicates</span></a>
<a class="sourceLine" id="cb21-11" data-line-number="11">industry_check<span class="op">$</span>multi_industry &lt;-<span class="st"> </span>industry_check <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb21-12" data-line-number="12"><span class="st">  </span><span class="kw">select</span>(customer_id) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb21-13" data-line-number="13"><span class="st">  </span><span class="kw">duplicated</span>()</a>
<a class="sourceLine" id="cb21-14" data-line-number="14"></a>
<a class="sourceLine" id="cb21-15" data-line-number="15"><span class="co">## if the customer id is duplicated, that means that it appeared in more than one industry</span></a>
<a class="sourceLine" id="cb21-16" data-line-number="16"></a>
<a class="sourceLine" id="cb21-17" data-line-number="17"></a>
<a class="sourceLine" id="cb21-18" data-line-number="18"><span class="co">## same as duplicate check for dates</span></a>
<a class="sourceLine" id="cb21-19" data-line-number="19">industry_checksum &lt;-<span class="st"> </span>industry_check <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb21-20" data-line-number="20"><span class="st">  </span><span class="kw">filter</span>(multi_industry <span class="op">==</span><span class="st"> &quot;TRUE&quot;</span>)</a>
<a class="sourceLine" id="cb21-21" data-line-number="21"></a>
<a class="sourceLine" id="cb21-22" data-line-number="22"><span class="cf">if</span> (<span class="kw">nrow</span>(industry_checksum) <span class="op">==</span><span class="st"> </span><span class="dv">0</span>){</a>
<a class="sourceLine" id="cb21-23" data-line-number="23">  <span class="kw">print</span> (<span class="st">&quot;No duplicate&quot;</span>)</a>
<a class="sourceLine" id="cb21-24" data-line-number="24">} <span class="cf">else</span>{</a>
<a class="sourceLine" id="cb21-25" data-line-number="25">  <span class="kw">print</span>(<span class="st">&quot;Yes duplicates&quot;</span>)</a>
<a class="sourceLine" id="cb21-26" data-line-number="26">}</a></code></pre></div>
<pre><code>## [1] &quot;No duplicate&quot;</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1"><span class="co"># Answer - No</span></a>
<a class="sourceLine" id="cb23-2" data-line-number="2"></a>
<a class="sourceLine" id="cb23-3" data-line-number="3"><span class="co"># Do any customers operate across locations?</span></a>
<a class="sourceLine" id="cb23-4" data-line-number="4"></a>
<a class="sourceLine" id="cb23-5" data-line-number="5"><span class="co">## same process as industry but for location</span></a>
<a class="sourceLine" id="cb23-6" data-line-number="6">location_check &lt;-<span class="st"> </span>transactions <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb23-7" data-line-number="7"><span class="st">  </span><span class="kw">select</span>(location, customer_id) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb23-8" data-line-number="8"><span class="st">  </span><span class="kw">distinct</span>()</a>
<a class="sourceLine" id="cb23-9" data-line-number="9"></a>
<a class="sourceLine" id="cb23-10" data-line-number="10">location_check<span class="op">$</span>multi_location &lt;-<span class="st"> </span>location_check <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb23-11" data-line-number="11"><span class="st">  </span><span class="kw">select</span>(customer_id) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb23-12" data-line-number="12"><span class="st">  </span><span class="kw">duplicated</span>()</a>
<a class="sourceLine" id="cb23-13" data-line-number="13"></a>
<a class="sourceLine" id="cb23-14" data-line-number="14">location_checksum&lt;-<span class="st"> </span>location_check <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb23-15" data-line-number="15"><span class="st">  </span><span class="kw">filter</span>(multi_location <span class="op">==</span><span class="st"> &quot;TRUE&quot;</span>)</a>
<a class="sourceLine" id="cb23-16" data-line-number="16"></a>
<a class="sourceLine" id="cb23-17" data-line-number="17"><span class="cf">if</span> (<span class="kw">nrow</span>(location_checksum) <span class="op">==</span><span class="st"> </span><span class="dv">0</span>){</a>
<a class="sourceLine" id="cb23-18" data-line-number="18">  <span class="kw">print</span> (<span class="st">&quot;No&quot;</span>)</a>
<a class="sourceLine" id="cb23-19" data-line-number="19">} <span class="cf">else</span>{</a>
<a class="sourceLine" id="cb23-20" data-line-number="20">  <span class="kw">print</span>(<span class="st">&quot;Yes&quot;</span>)</a>
<a class="sourceLine" id="cb23-21" data-line-number="21">}</a></code></pre></div>
<pre><code>## [1] &quot;No&quot;</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1"><span class="co"># Answer - No</span></a></code></pre></div>
</div>
<div id="industry" class="section level3">
<h3><span class="header-section-number">2.3.2</span> Industry</h3>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1"><span class="co"># Number of transactons per industry</span></a>
<a class="sourceLine" id="cb26-2" data-line-number="2"></a>
<a class="sourceLine" id="cb26-3" data-line-number="3"><span class="co">## using only customer_id and industry, creates a bar plot, counting how many times each industry appeared</span></a>
<a class="sourceLine" id="cb26-4" data-line-number="4">transactions <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb26-5" data-line-number="5"><span class="st">  </span><span class="kw">select</span>(customer_id, industry) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb26-6" data-line-number="6"><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> industry)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>()</a></code></pre></div>
<p><img src="_main_files/figure-html/Initial_Queries_Industry-1.png" width="672" /></p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1"><span class="co"># Industries 1 &amp; 2 have a much larger number of transactions, similarly industries 6 &amp; 10 appear quite low</span></a>
<a class="sourceLine" id="cb27-2" data-line-number="2"></a>
<a class="sourceLine" id="cb27-3" data-line-number="3"><span class="co">## create a summary of transactions per industry in a table</span></a>
<a class="sourceLine" id="cb27-4" data-line-number="4"></a>
<a class="sourceLine" id="cb27-5" data-line-number="5">number_of_transactions_per_industry &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">table</span>(transactions<span class="op">$</span>industry))</a>
<a class="sourceLine" id="cb27-6" data-line-number="6"><span class="co">## give the columns readable names</span></a>
<a class="sourceLine" id="cb27-7" data-line-number="7"><span class="kw">names</span>(number_of_transactions_per_industry) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;industry&quot;</span>, <span class="st">&quot;count&quot;</span>)</a>
<a class="sourceLine" id="cb27-8" data-line-number="8">number_of_transactions_per_industry</a></code></pre></div>
<pre><code>##    industry count
## 1         1 44901
## 2         2 22043
## 3         3  8336
## 4         4  5896
## 5         5  3341
## 6         6   195
## 7         7  3912
## 8         8  2815
## 9         9  2090
## 10       10   719</code></pre>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1"><span class="co"># calculates mean of transactions per industry</span></a>
<a class="sourceLine" id="cb29-2" data-line-number="2">ntpi_mean &lt;-<span class="st"> </span><span class="kw">mean</span>(number_of_transactions_per_industry<span class="op">$</span>count)</a>
<a class="sourceLine" id="cb29-3" data-line-number="3"><span class="co">## calculates standard deviation of transactions per industry </span></a>
<a class="sourceLine" id="cb29-4" data-line-number="4">ntpi_sd &lt;-<span class="st"> </span><span class="kw">sd</span>(number_of_transactions_per_industry<span class="op">$</span>count)</a>
<a class="sourceLine" id="cb29-5" data-line-number="5"><span class="co">## calculates standard deviations from mean for each count</span></a>
<a class="sourceLine" id="cb29-6" data-line-number="6">number_of_transactions_per_industry<span class="op">$</span>SDs &lt;-<span class="st"> </span>(number_of_transactions_per_industry<span class="op">$</span>count <span class="op">-</span><span class="st"> </span>ntpi_mean)<span class="op">/</span>ntpi_sd </a>
<a class="sourceLine" id="cb29-7" data-line-number="7">number_of_transactions_per_industry</a></code></pre></div>
<pre><code>##    industry count         SDs
## 1         1 44901  2.53884748
## 2         2 22043  0.90301908
## 3         3  8336 -0.07791976
## 4         4  5896 -0.25253790
## 5         5  3341 -0.43538599
## 6         6   195 -0.66052888
## 7         7  3912 -0.39452248
## 8         8  2815 -0.47302908
## 9         9  2090 -0.52491356
## 10       10   719 -0.62302892</code></pre>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" data-line-number="1"><span class="co"># industry 1 is 2.5 standard deviations from the mean however industry 2 is within 1 standard deviation</span></a>
<a class="sourceLine" id="cb31-2" data-line-number="2"></a>
<a class="sourceLine" id="cb31-3" data-line-number="3"><span class="co"># number of customer per industry</span></a>
<a class="sourceLine" id="cb31-4" data-line-number="4"></a>
<a class="sourceLine" id="cb31-5" data-line-number="5"><span class="co">## creates a bar plot, counting how many times each industry appeared</span></a>
<a class="sourceLine" id="cb31-6" data-line-number="6">transactions <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb31-7" data-line-number="7"><span class="st">  </span><span class="co">## selects only unique customer id&#39;s per industry so each customer is only counted once</span></a>
<a class="sourceLine" id="cb31-8" data-line-number="8"><span class="st">  </span><span class="kw">distinct</span>(customer_id, industry) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb31-9" data-line-number="9"><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> industry)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>()</a></code></pre></div>
<p><img src="_main_files/figure-html/Initial_Queries_Industry-2.png" width="672" /></p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" data-line-number="1"><span class="co"># a similar trend appears in the number of customers, likely as each customer can have a maximum of 47 transactions</span></a>
<a class="sourceLine" id="cb32-2" data-line-number="2"></a>
<a class="sourceLine" id="cb32-3" data-line-number="3"><span class="co">## creates a table summarising each customer into a single entry, keeping other information</span></a>
<a class="sourceLine" id="cb32-4" data-line-number="4">number_of_customers_per_industry &lt;-<span class="st"> </span><span class="kw">group_by</span>(transactions, customer_id, industry) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb32-5" data-line-number="5"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean_amount =</span> <span class="kw">mean</span>(monthly_amount))</a>
<a class="sourceLine" id="cb32-6" data-line-number="6"></a>
<a class="sourceLine" id="cb32-7" data-line-number="7"><span class="co">## organises counts into a dataframe</span></a>
<a class="sourceLine" id="cb32-8" data-line-number="8">number_of_customers_per_industry &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">table</span>(number_of_customers_per_industry<span class="op">$</span>industry))</a>
<a class="sourceLine" id="cb32-9" data-line-number="9"><span class="co">## readable column headers</span></a>
<a class="sourceLine" id="cb32-10" data-line-number="10"><span class="kw">names</span>(number_of_customers_per_industry) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;industry&quot;</span>, <span class="st">&quot;count&quot;</span>)</a>
<a class="sourceLine" id="cb32-11" data-line-number="11">number_of_customers_per_industry</a></code></pre></div>
<pre><code>##    industry count
## 1         1  1953
## 2         2  1364
## 3         3   399
## 4         4   199
## 5         5   127
## 6         6     7
## 7         7   184
## 8         8   109
## 9         9    90
## 10       10    32</code></pre>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" data-line-number="1"><span class="co">## deviations from mean count</span></a>
<a class="sourceLine" id="cb34-2" data-line-number="2">ncpi_mean &lt;-<span class="st"> </span><span class="kw">mean</span>(number_of_customers_per_industry<span class="op">$</span>count)</a>
<a class="sourceLine" id="cb34-3" data-line-number="3">ncpi_sd &lt;-<span class="st"> </span><span class="kw">sd</span>(number_of_customers_per_industry<span class="op">$</span>count)</a>
<a class="sourceLine" id="cb34-4" data-line-number="4">number_of_customers_per_industry<span class="op">$</span>SDs &lt;-<span class="st"> </span>(number_of_customers_per_industry<span class="op">$</span>count <span class="op">-</span><span class="st"> </span>ncpi_mean)<span class="op">/</span>ncpi_sd </a>
<a class="sourceLine" id="cb34-5" data-line-number="5">number_of_customers_per_industry</a></code></pre></div>
<pre><code>##    industry count         SDs
## 1         1  1953  2.27363548
## 2         2  1364  1.38476564
## 3         3   399 -0.07153214
## 4         4   199 -0.37335551
## 5         5   127 -0.48201193
## 6         6     7 -0.66310595
## 7         7   184 -0.39599227
## 8         8   109 -0.50917603
## 9         9    90 -0.53784925
## 10       10    32 -0.62537803</code></pre>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" data-line-number="1"><span class="co"># industry 1 has 2.2 standard deviation higher customer count, this skews the sd count for other industries</span></a>
<a class="sourceLine" id="cb36-2" data-line-number="2"><span class="co"># industry 7 only has a total of 7 customers</span></a>
<a class="sourceLine" id="cb36-3" data-line-number="3"></a>
<a class="sourceLine" id="cb36-4" data-line-number="4"><span class="co">## subset data for industry 6</span></a>
<a class="sourceLine" id="cb36-5" data-line-number="5">industry_<span class="dv">6</span> &lt;-<span class="st"> </span>transactions <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb36-6" data-line-number="6"><span class="st">  </span><span class="kw">filter</span>(industry <span class="op">==</span><span class="st"> </span><span class="dv">6</span>)</a>
<a class="sourceLine" id="cb36-7" data-line-number="7"><span class="kw">summary</span>(industry_<span class="dv">6</span>)</a></code></pre></div>
<pre><code>##      trdate                                     customer_id    industry  
##  Min.   :2013-01-01   6c530aae768250b8d9c3c908a13ee287:47   6      :195  
##  1st Qu.:2013-10-01   d278df4919453195d221030324127a0e:47   1      :  0  
##  Median :2014-07-01   23755432da68528f115c9633c0d7834f:28   2      :  0  
##  Mean   :2014-08-30   ecf4afbea9a7f57c4c6da70593361d67:22   3      :  0  
##  3rd Qu.:2015-07-01   8196e8d0f9ee7dfdfc7e11dbbfa30d77:21   4      :  0  
##  Max.   :2016-11-01   a2a7902052d85a18a7b564d8872f1ff6:19   5      :  0  
##                       (Other)                         :11   (Other):  0  
##     location   monthly_amount     
##  1      :195   Min.   :        0  
##  2      :  0   1st Qu.:   680283  
##  3      :  0   Median : 21588432  
##  4      :  0   Mean   : 27063231  
##  5      :  0   3rd Qu.: 47028767  
##  6      :  0   Max.   :100000000  
##  (Other):  0</code></pre>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb38-1" data-line-number="1"><span class="kw">nrow</span>(industry_<span class="dv">6</span>)</a></code></pre></div>
<pre><code>## [1] 195</code></pre>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb40-1" data-line-number="1"><span class="co"># 195 total entries for industry 6</span></a>
<a class="sourceLine" id="cb40-2" data-line-number="2"><span class="co"># all 7 customers in industry 6 operate in location 1</span></a>
<a class="sourceLine" id="cb40-3" data-line-number="3"><span class="co"># the range is still 0-100M meaning both values exist in industry 6</span></a>
<a class="sourceLine" id="cb40-4" data-line-number="4"></a>
<a class="sourceLine" id="cb40-5" data-line-number="5"><span class="co">#try removing the industry  subset and checking table summary</span></a>
<a class="sourceLine" id="cb40-6" data-line-number="6"></a>
<a class="sourceLine" id="cb40-7" data-line-number="7"><span class="co">## subset data without industry 6</span></a>
<a class="sourceLine" id="cb40-8" data-line-number="8">industry_no_<span class="dv">6</span> &lt;-<span class="st"> </span>transactions <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb40-9" data-line-number="9"><span class="st">  </span><span class="kw">filter</span>(industry <span class="op">!=</span><span class="st"> </span><span class="dv">6</span>)</a>
<a class="sourceLine" id="cb40-10" data-line-number="10"><span class="kw">summary</span>(industry_no_<span class="dv">6</span>)</a></code></pre></div>
<pre><code>##      trdate                                     customer_id       industry    
##  Min.   :2013-01-01   0023a1e3447fdb31836536cc903f1310:   47   1      :44901  
##  1st Qu.:2014-05-01   006c64491cb8acf2092ce0e0341797fe:   47   2      :22043  
##  Median :2015-06-01   0079e3e6d496ad07cee7fd63d3d7c9b2:   47   3      : 8336  
##  Mean   :2015-03-27   00989c20ff1386dc386d8124ebcba1a5:   47   4      : 5896  
##  3rd Qu.:2016-03-01   00bbd6beace7365b27a913db75fddce9:   47   7      : 3912  
##  Max.   :2016-11-01   01882513d5fa7c329e940dda99b12147:   47   5      : 3341  
##                       (Other)                         :93771   (Other): 5624  
##     location     monthly_amount    
##  2      :21410   Min.   :   45986  
##  1      :17465   1st Qu.:   95230  
##  5      : 9703   Median :  179018  
##  4      : 9351   Mean   :  340107  
##  6      : 7446   3rd Qu.:  373432  
##  7      : 7317   Max.   :64935696  
##  (Other):21361</code></pre>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb42-1" data-line-number="1"><span class="co"># the lowest value is now $45k and highest is $64M</span></a>
<a class="sourceLine" id="cb42-2" data-line-number="2"><span class="co"># Meaning industry 6 contains both the lowest and highest monthly_amounts in the dataset</span></a>
<a class="sourceLine" id="cb42-3" data-line-number="3"><span class="co"># industry 6&#39;s data looks questionable</span></a></code></pre></div>
</div>
<div id="industry-6" class="section level3">
<h3><span class="header-section-number">2.3.3</span> Industry 6</h3>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb43-1" data-line-number="1"><span class="co"># if all zero values in the dataset are in industry 6, are zero values common?</span></a>
<a class="sourceLine" id="cb43-2" data-line-number="2">industry_<span class="dv">6</span> <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb43-3" data-line-number="3"><span class="st">  </span><span class="kw">filter</span>(monthly_amount <span class="op">==</span><span class="st"> </span><span class="dv">0</span>)</a></code></pre></div>
<pre><code>## # A tibble: 1 x 5
##   trdate     customer_id                      industry location monthly_amount
##   &lt;date&gt;     &lt;fct&gt;                            &lt;fct&gt;    &lt;fct&gt;             &lt;dbl&gt;
## 1 2015-03-01 23755432da68528f115c9633c0d7834f 6        1                     0</code></pre>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb45-1" data-line-number="1"><span class="co">#only one monthly amount of 0, and the next lowest is 45k in the dataset indicates its inclusion is likely and error</span></a>
<a class="sourceLine" id="cb45-2" data-line-number="2"><span class="co"># remove this value from industry_6 subset and main dataset</span></a>
<a class="sourceLine" id="cb45-3" data-line-number="3"></a>
<a class="sourceLine" id="cb45-4" data-line-number="4">industry_<span class="dv">6</span> &lt;-<span class="st"> </span>industry_<span class="dv">6</span> <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb45-5" data-line-number="5"><span class="st">  </span><span class="kw">filter</span>(monthly_amount <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb45-6" data-line-number="6"></a>
<a class="sourceLine" id="cb45-7" data-line-number="7">transactions &lt;-<span class="st"> </span>transactions <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb45-8" data-line-number="8"><span class="st">  </span><span class="kw">filter</span>(monthly_amount <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb45-9" data-line-number="9"></a>
<a class="sourceLine" id="cb45-10" data-line-number="10"><span class="co">## plotting monlthy amount against date, colouring the plot by customer_id</span></a>
<a class="sourceLine" id="cb45-11" data-line-number="11"><span class="kw">ggplot</span>(industry_<span class="dv">6</span>, <span class="kw">aes</span>(<span class="dt">x =</span> trdate, <span class="dt">y =</span> monthly_amount, <span class="dt">color =</span> customer_id)) <span class="op">+</span></a>
<a class="sourceLine" id="cb45-12" data-line-number="12"><span class="st">  </span><span class="co">#changes the opacity of each point so overlapping points are easier to differentiate</span></a>
<a class="sourceLine" id="cb45-13" data-line-number="13"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">0.5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb45-14" data-line-number="14"><span class="st">  </span><span class="kw">facet_wrap</span>(industry_<span class="dv">6</span><span class="op">$</span>customer_id)</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb46-1" data-line-number="1"><span class="co">#mean of each customer&#39;s monthly payments in industry_6</span></a>
<a class="sourceLine" id="cb46-2" data-line-number="2">i6_customer_summary &lt;-<span class="st"> </span>industry_<span class="dv">6</span> <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb46-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(customer_id) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb46-4" data-line-number="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean_amount =</span> <span class="kw">mean</span>(monthly_amount))</a>
<a class="sourceLine" id="cb46-5" data-line-number="5">i6_customer_summary</a></code></pre></div>
<pre><code>## # A tibble: 7 x 2
##   customer_id                      mean_amount
##   &lt;fct&gt;                                  &lt;dbl&gt;
## 1 23755432da68528f115c9633c0d7834f   54404455.
## 2 6c530aae768250b8d9c3c908a13ee287     494993.
## 3 8196e8d0f9ee7dfdfc7e11dbbfa30d77   18846950.
## 4 a2a7902052d85a18a7b564d8872f1ff6    1680022.
## 5 bd853b475d59821e100d3d24303d7747   15806921.
## 6 d278df4919453195d221030324127a0e   35334792.
## 7 ecf4afbea9a7f57c4c6da70593361d67   69219425.</code></pre>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb48-1" data-line-number="1"><span class="co"># it appears the 100M ammount is correct from the plot if it belongs to customer ecf</span></a>
<a class="sourceLine" id="cb48-2" data-line-number="2"></a>
<a class="sourceLine" id="cb48-3" data-line-number="3">industry_<span class="dv">6</span> <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb48-4" data-line-number="4"><span class="st">  </span><span class="kw">filter</span>(monthly_amount <span class="op">==</span><span class="st"> </span><span class="dv">100000000</span>)</a></code></pre></div>
<pre><code>## # A tibble: 1 x 5
##   trdate     customer_id                      industry location monthly_amount
##   &lt;date&gt;     &lt;fct&gt;                            &lt;fct&gt;    &lt;fct&gt;             &lt;dbl&gt;
## 1 2016-10-01 ecf4afbea9a7f57c4c6da70593361d67 6        1             100000000</code></pre>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb50-1" data-line-number="1"><span class="co"># it does, it will remain in the dataset</span></a>
<a class="sourceLine" id="cb50-2" data-line-number="2"></a>
<a class="sourceLine" id="cb50-3" data-line-number="3"><span class="co"># check the distribution of the main dataset with and without industry 6</span></a>
<a class="sourceLine" id="cb50-4" data-line-number="4"></a>
<a class="sourceLine" id="cb50-5" data-line-number="5"><span class="co"># with industry 6 (the large spread indicated a need for more bins)</span></a>
<a class="sourceLine" id="cb50-6" data-line-number="6"><span class="kw">ggplot</span>(transactions, <span class="kw">aes</span>(<span class="dt">x =</span> monthly_amount)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">bins =</span> <span class="dv">1000</span>)</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-2-2.png" width="672" /></p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb51-1" data-line-number="1"><span class="co">#the data is heavily skewed industry 6&#39;s high amounts for customer 6c530aae768250b8d9c3c908a13ee287 appear to be outliers</span></a>
<a class="sourceLine" id="cb51-2" data-line-number="2"></a>
<a class="sourceLine" id="cb51-3" data-line-number="3"><span class="co"># without industry 6</span></a>
<a class="sourceLine" id="cb51-4" data-line-number="4"></a>
<a class="sourceLine" id="cb51-5" data-line-number="5"><span class="co">## remake industry_no_6 subset due to removal of 0 transactions</span></a>
<a class="sourceLine" id="cb51-6" data-line-number="6"></a>
<a class="sourceLine" id="cb51-7" data-line-number="7">industry_no_<span class="dv">6</span> &lt;-<span class="st"> </span>transactions <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb51-8" data-line-number="8"><span class="st">  </span><span class="kw">filter</span>(industry <span class="op">!=</span><span class="st"> </span><span class="dv">6</span>)</a>
<a class="sourceLine" id="cb51-9" data-line-number="9"><span class="kw">summary</span>(industry_no_<span class="dv">6</span>)</a></code></pre></div>
<pre><code>##      trdate                                     customer_id       industry    
##  Min.   :2013-01-01   0023a1e3447fdb31836536cc903f1310:   47   1      :44901  
##  1st Qu.:2014-05-01   006c64491cb8acf2092ce0e0341797fe:   47   2      :22043  
##  Median :2015-06-01   0079e3e6d496ad07cee7fd63d3d7c9b2:   47   3      : 8336  
##  Mean   :2015-03-27   00989c20ff1386dc386d8124ebcba1a5:   47   4      : 5896  
##  3rd Qu.:2016-03-01   00bbd6beace7365b27a913db75fddce9:   47   7      : 3912  
##  Max.   :2016-11-01   01882513d5fa7c329e940dda99b12147:   47   5      : 3341  
##                       (Other)                         :93771   (Other): 5624  
##     location     monthly_amount    
##  2      :21410   Min.   :   45986  
##  1      :17465   1st Qu.:   95230  
##  5      : 9703   Median :  179018  
##  4      : 9351   Mean   :  340107  
##  6      : 7446   3rd Qu.:  373432  
##  7      : 7317   Max.   :64935696  
##  (Other):21361</code></pre>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb53-1" data-line-number="1"><span class="kw">ggplot</span>(industry_no_<span class="dv">6</span>, <span class="kw">aes</span>(<span class="dt">x =</span> monthly_amount)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">bins =</span> <span class="dv">1000</span>)</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-2-3.png" width="672" /></p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb54-1" data-line-number="1"><span class="co"># the data is still quite skewed this will need to be addressed later</span></a>
<a class="sourceLine" id="cb54-2" data-line-number="2"></a>
<a class="sourceLine" id="cb54-3" data-line-number="3"><span class="co"># the plots for the customer in industry 6 except 6c530aae768250b8d9c3c908a13ee287 and a2a7902052d85a18a7b564d8872f1ff6 appear legitimate at this scale a closer inspection of those two customers is needed to reduce the issues with scaling</span></a>
<a class="sourceLine" id="cb54-4" data-line-number="4"></a>
<a class="sourceLine" id="cb54-5" data-line-number="5"><span class="co"># customer 6c530aae768250b8d9c3c908a13ee287</span></a>
<a class="sourceLine" id="cb54-6" data-line-number="6"></a>
<a class="sourceLine" id="cb54-7" data-line-number="7">industry_<span class="dv">6</span> <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb54-8" data-line-number="8"><span class="st">  </span><span class="kw">filter</span>(customer_id <span class="op">==</span><span class="st"> &quot;6c530aae768250b8d9c3c908a13ee287&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb54-9" data-line-number="9"><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span> trdate, <span class="dt">y =</span> monthly_amount)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">0.5</span>)</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-2-4.png" width="672" /></p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb55-1" data-line-number="1"><span class="co"># customer a2a7902052d85a18a7b564d8872f1ff6</span></a>
<a class="sourceLine" id="cb55-2" data-line-number="2"></a>
<a class="sourceLine" id="cb55-3" data-line-number="3">industry_<span class="dv">6</span> <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb55-4" data-line-number="4"><span class="st">  </span><span class="kw">filter</span>(customer_id <span class="op">==</span><span class="st"> &quot;a2a7902052d85a18a7b564d8872f1ff6&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb55-5" data-line-number="5"><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span> trdate, <span class="dt">y =</span> monthly_amount)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">0.5</span>)</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-2-5.png" width="672" /></p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb56-1" data-line-number="1"><span class="co"># at their own scales both customers transactions do not look suspicious, though still quite low</span></a></code></pre></div>
</div>
<div id="industry-10" class="section level3">
<h3><span class="header-section-number">2.3.4</span> Industry 10</h3>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb57-1" data-line-number="1"><span class="co"># A look into industry 10</span></a>
<a class="sourceLine" id="cb57-2" data-line-number="2"></a>
<a class="sourceLine" id="cb57-3" data-line-number="3">industry_<span class="dv">10</span> &lt;-<span class="st"> </span>transactions <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb57-4" data-line-number="4"><span class="st">  </span><span class="kw">filter</span>(industry <span class="op">==</span><span class="st"> </span><span class="dv">10</span>)</a>
<a class="sourceLine" id="cb57-5" data-line-number="5"><span class="kw">summary</span>(industry_<span class="dv">10</span>)</a></code></pre></div>
<pre><code>##      trdate                                     customer_id     industry  
##  Min.   :2013-01-01   0079e3e6d496ad07cee7fd63d3d7c9b2: 47   10     :719  
##  1st Qu.:2013-10-01   6410bb923bcf940b7c57331f7b7db3c6: 47   1      :  0  
##  Median :2014-11-01   82aa4b0af34c2313a562076992e50aa3: 47   2      :  0  
##  Mean   :2014-10-27   99701e768d9a09b314e43a1d9e3e9dfa: 47   3      :  0  
##  3rd Qu.:2015-12-01   9a0f86604fa1dc1686a0cad86a808a5c: 47   4      :  0  
##  Max.   :2016-11-01   d714d2c5a796d5814c565d78dd16188d: 47   5      :  0  
##                       (Other)                         :437   (Other):  0  
##     location   monthly_amount    
##  5      :315   Min.   :   63982  
##  2      :167   1st Qu.:   96779  
##  8      : 94   Median :  154789  
##  7      : 61   Mean   : 2926552  
##  4      : 29   3rd Qu.:  246281  
##  9      : 21   Max.   :64935696  
##  (Other): 32</code></pre>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb59-1" data-line-number="1"><span class="kw">ggplot</span>(industry_<span class="dv">10</span>, <span class="kw">aes</span>(<span class="dt">x =</span> trdate, <span class="dt">y =</span> monthly_amount)) <span class="op">+</span></a>
<a class="sourceLine" id="cb59-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">0.5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb59-3" data-line-number="3"><span class="st">  </span><span class="kw">facet_wrap</span>(industry_<span class="dv">10</span><span class="op">$</span>location)</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb60-1" data-line-number="1"><span class="co"># the number of transactions by location within industry 10 appear quite inconsistent</span></a>
<a class="sourceLine" id="cb60-2" data-line-number="2"></a>
<a class="sourceLine" id="cb60-3" data-line-number="3">industry_<span class="dv">10</span>_locations &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">table</span>(industry_<span class="dv">10</span><span class="op">$</span>location))</a>
<a class="sourceLine" id="cb60-4" data-line-number="4"><span class="co">## give the columns readable names</span></a>
<a class="sourceLine" id="cb60-5" data-line-number="5"><span class="kw">names</span>(industry_<span class="dv">10</span>_locations) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;location&quot;</span>, <span class="st">&quot;count&quot;</span>)</a>
<a class="sourceLine" id="cb60-6" data-line-number="6">industry_<span class="dv">10</span>_locations</a></code></pre></div>
<pre><code>##    location count
## 1         1    16
## 2         2   167
## 3         3    12
## 4         4    29
## 5         5   315
## 6         6     0
## 7         7    61
## 8         8    94
## 9         9    21
## 10       10     4</code></pre>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb62-1" data-line-number="1"><span class="co"># industry 10 is missing location 6</span></a>
<a class="sourceLine" id="cb62-2" data-line-number="2"><span class="co"># is it possible industry 6 in location 1 corresponds to industry 10 location 6?</span></a>
<a class="sourceLine" id="cb62-3" data-line-number="3"><span class="co"># industry 10 location 10 only has 4 entires</span></a>
<a class="sourceLine" id="cb62-4" data-line-number="4"></a>
<a class="sourceLine" id="cb62-5" data-line-number="5"><span class="kw">ggplot</span>(<span class="kw">filter</span>(industry_<span class="dv">10</span>, location <span class="op">==</span><span class="st"> </span><span class="dv">10</span>), <span class="kw">aes</span>(<span class="dt">x =</span> trdate, <span class="dt">y =</span> monthly_amount)) <span class="op">+</span></a>
<a class="sourceLine" id="cb62-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">0.5</span>)</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-3-2.png" width="672" /></p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb63-1" data-line-number="1"><span class="co"># the values are low but do not appear illigitimate</span></a>
<a class="sourceLine" id="cb63-2" data-line-number="2"></a>
<a class="sourceLine" id="cb63-3" data-line-number="3"><span class="co"># industry 10 location 8 has a large difference between 2 sets of transactions</span></a>
<a class="sourceLine" id="cb63-4" data-line-number="4"></a>
<a class="sourceLine" id="cb63-5" data-line-number="5">industry_<span class="dv">10</span> <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb63-6" data-line-number="6"><span class="st">  </span><span class="kw">filter</span>(location <span class="op">==</span><span class="st"> </span><span class="dv">8</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb63-7" data-line-number="7"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> trdate, <span class="dt">y =</span> monthly_amount, <span class="dt">color =</span> customer_id)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-3-3.png" width="672" /></p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb64-1" data-line-number="1"><span class="co">## only two customers in industry 10 location 8</span></a>
<a class="sourceLine" id="cb64-2" data-line-number="2"></a>
<a class="sourceLine" id="cb64-3" data-line-number="3">i10_l8 &lt;-industry_<span class="dv">10</span> <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb64-4" data-line-number="4"><span class="st">  </span><span class="kw">filter</span>(location <span class="op">==</span><span class="st"> </span><span class="dv">8</span>) </a>
<a class="sourceLine" id="cb64-5" data-line-number="5"></a>
<a class="sourceLine" id="cb64-6" data-line-number="6"><span class="co"># customer d714d2c5a796d5814c565d78dd16188d</span></a>
<a class="sourceLine" id="cb64-7" data-line-number="7"></a>
<a class="sourceLine" id="cb64-8" data-line-number="8">i10_l8 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb64-9" data-line-number="9"><span class="st">  </span><span class="kw">filter</span>(customer_id <span class="op">==</span><span class="st"> &quot;d714d2c5a796d5814c565d78dd16188d&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb64-10" data-line-number="10"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> trdate, <span class="dt">y =</span> monthly_amount)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-3-4.png" width="672" /></p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb65-1" data-line-number="1"><span class="co"># transactions are very cyclic and high</span></a>
<a class="sourceLine" id="cb65-2" data-line-number="2"></a>
<a class="sourceLine" id="cb65-3" data-line-number="3"><span class="co"># customer db8e1af0cb3aca1ae2d0018624204529</span></a>
<a class="sourceLine" id="cb65-4" data-line-number="4"></a>
<a class="sourceLine" id="cb65-5" data-line-number="5">i10_l8 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb65-6" data-line-number="6"><span class="st">  </span><span class="kw">filter</span>(customer_id <span class="op">==</span><span class="st"> &quot;db8e1af0cb3aca1ae2d0018624204529&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb65-7" data-line-number="7"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> trdate, <span class="dt">y =</span> monthly_amount)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-3-5.png" width="672" /></p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb66-1" data-line-number="1"><span class="co"># transactions are quite random</span></a></code></pre></div>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb67-1" data-line-number="1"><span class="co"># Number of transactions per location</span></a>
<a class="sourceLine" id="cb67-2" data-line-number="2">number_of_transactions_per_location &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">table</span>(transactions<span class="op">$</span>location))</a>
<a class="sourceLine" id="cb67-3" data-line-number="3"><span class="kw">names</span>(number_of_transactions_per_location) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;location&quot;</span>, count)</a>
<a class="sourceLine" id="cb67-4" data-line-number="4">number_of_transactions_per_location</a></code></pre></div>
<pre><code>##    location
## 1         1
## 2         2
## 3         3
## 4         4
## 5         5
## 6         6
## 7         7
## 8         8
## 9         9
## 10       10
##    function (x, ..., wt = NULL, sort = FALSE, name = &quot;n&quot;, .drop = group_by_drop_default(x)) \n{\n    groups &lt;- group_vars(x)\n    if (dots_n(...)) {\n        x &lt;- .group_by_static_drop(x, ..., add = TRUE, .drop = .drop)\n    }\n    x &lt;- tally(x, wt = !!enquo( ...
## 1                                                                                                                                                                                                                                                                 17659
## 2                                                                                                                                                                                                                                                                 21410
## 3                                                                                                                                                                                                                                                                  6740
## 4                                                                                                                                                                                                                                                                  9351
## 5                                                                                                                                                                                                                                                                  9703
## 6                                                                                                                                                                                                                                                                  7446
## 7                                                                                                                                                                                                                                                                  7317
## 8                                                                                                                                                                                                                                                                  3478
## 9                                                                                                                                                                                                                                                                  4629
## 10                                                                                                                                                                                                                                                                 6514</code></pre>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb69-1" data-line-number="1"><span class="kw">sd</span>(number_of_transactions_per_location<span class="op">$</span>count)</a></code></pre></div>
<pre><code>## [1] NA</code></pre>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb71-1" data-line-number="1"><span class="co"># number of customers per location</span></a></code></pre></div>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb72-1" data-line-number="1"><span class="co">#Import new function for managing large plots</span></a>
<a class="sourceLine" id="cb72-2" data-line-number="2"></a>
<a class="sourceLine" id="cb72-3" data-line-number="3"><span class="co"># Multiple plot function</span></a>
<a class="sourceLine" id="cb72-4" data-line-number="4"><span class="co">#</span></a>
<a class="sourceLine" id="cb72-5" data-line-number="5"><span class="co"># ggplot objects can be passed in ..., or to plotlist (as a list of ggplot objects)</span></a>
<a class="sourceLine" id="cb72-6" data-line-number="6"><span class="co"># - cols:   Number of columns in layout</span></a>
<a class="sourceLine" id="cb72-7" data-line-number="7"><span class="co"># - layout: A matrix specifying the layout. If present, &#39;cols&#39; is ignored.</span></a>
<a class="sourceLine" id="cb72-8" data-line-number="8"><span class="co">#</span></a>
<a class="sourceLine" id="cb72-9" data-line-number="9"><span class="co"># If the layout is something like matrix(c(1,2,3,3), nrow=2, byrow=TRUE),</span></a>
<a class="sourceLine" id="cb72-10" data-line-number="10"><span class="co"># then plot 1 will go in the upper left, 2 will go in the upper right, and</span></a>
<a class="sourceLine" id="cb72-11" data-line-number="11"><span class="co"># 3 will go all the way across the bottom.</span></a>
<a class="sourceLine" id="cb72-12" data-line-number="12"><span class="co">#</span></a>
<a class="sourceLine" id="cb72-13" data-line-number="13">multiplot &lt;-<span class="st"> </span><span class="cf">function</span>(..., <span class="dt">plotlist=</span><span class="ot">NULL</span>, file, <span class="dt">cols=</span><span class="dv">1</span>, <span class="dt">layout=</span><span class="ot">NULL</span>) {</a>
<a class="sourceLine" id="cb72-14" data-line-number="14">  <span class="kw">library</span>(grid)</a>
<a class="sourceLine" id="cb72-15" data-line-number="15"></a>
<a class="sourceLine" id="cb72-16" data-line-number="16">  <span class="co"># Make a list from the ... arguments and plotlist</span></a>
<a class="sourceLine" id="cb72-17" data-line-number="17">  plots &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">list</span>(...), plotlist)</a>
<a class="sourceLine" id="cb72-18" data-line-number="18"></a>
<a class="sourceLine" id="cb72-19" data-line-number="19">  numPlots =<span class="st"> </span><span class="kw">length</span>(plots)</a>
<a class="sourceLine" id="cb72-20" data-line-number="20"></a>
<a class="sourceLine" id="cb72-21" data-line-number="21">  <span class="co"># If layout is NULL, then use &#39;cols&#39; to determine layout</span></a>
<a class="sourceLine" id="cb72-22" data-line-number="22">  <span class="cf">if</span> (<span class="kw">is.null</span>(layout)) {</a>
<a class="sourceLine" id="cb72-23" data-line-number="23">    <span class="co"># Make the panel</span></a>
<a class="sourceLine" id="cb72-24" data-line-number="24">    <span class="co"># ncol: Number of columns of plots</span></a>
<a class="sourceLine" id="cb72-25" data-line-number="25">    <span class="co"># nrow: Number of rows needed, calculated from # of cols</span></a>
<a class="sourceLine" id="cb72-26" data-line-number="26">    layout &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">seq</span>(<span class="dv">1</span>, cols <span class="op">*</span><span class="st"> </span><span class="kw">ceiling</span>(numPlots<span class="op">/</span>cols)),</a>
<a class="sourceLine" id="cb72-27" data-line-number="27">                    <span class="dt">ncol =</span> cols, <span class="dt">nrow =</span> <span class="kw">ceiling</span>(numPlots<span class="op">/</span>cols))</a>
<a class="sourceLine" id="cb72-28" data-line-number="28">  }</a>
<a class="sourceLine" id="cb72-29" data-line-number="29"></a>
<a class="sourceLine" id="cb72-30" data-line-number="30"> <span class="cf">if</span> (numPlots<span class="op">==</span><span class="dv">1</span>) {</a>
<a class="sourceLine" id="cb72-31" data-line-number="31">    <span class="kw">print</span>(plots[[<span class="dv">1</span>]])</a>
<a class="sourceLine" id="cb72-32" data-line-number="32"></a>
<a class="sourceLine" id="cb72-33" data-line-number="33">  } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb72-34" data-line-number="34">    <span class="co"># Set up the page</span></a>
<a class="sourceLine" id="cb72-35" data-line-number="35">    <span class="kw">grid.newpage</span>()</a>
<a class="sourceLine" id="cb72-36" data-line-number="36">    <span class="kw">pushViewport</span>(<span class="kw">viewport</span>(<span class="dt">layout =</span> <span class="kw">grid.layout</span>(<span class="kw">nrow</span>(layout), <span class="kw">ncol</span>(layout))))</a>
<a class="sourceLine" id="cb72-37" data-line-number="37"></a>
<a class="sourceLine" id="cb72-38" data-line-number="38">    <span class="co"># Make each plot, in the correct location</span></a>
<a class="sourceLine" id="cb72-39" data-line-number="39">    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>numPlots) {</a>
<a class="sourceLine" id="cb72-40" data-line-number="40">      <span class="co"># Get the i,j matrix positions of the regions that contain this subplot</span></a>
<a class="sourceLine" id="cb72-41" data-line-number="41">      matchidx &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">which</span>(layout <span class="op">==</span><span class="st"> </span>i, <span class="dt">arr.ind =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb72-42" data-line-number="42"></a>
<a class="sourceLine" id="cb72-43" data-line-number="43">      <span class="kw">print</span>(plots[[i]], <span class="dt">vp =</span> <span class="kw">viewport</span>(<span class="dt">layout.pos.row =</span> matchidx<span class="op">$</span>row,</a>
<a class="sourceLine" id="cb72-44" data-line-number="44">                                      <span class="dt">layout.pos.col =</span> matchidx<span class="op">$</span>col))</a>
<a class="sourceLine" id="cb72-45" data-line-number="45">    }</a>
<a class="sourceLine" id="cb72-46" data-line-number="46">  }</a>
<a class="sourceLine" id="cb72-47" data-line-number="47">}</a></code></pre></div>
</div>
</div>
<div id="monthly-amount" class="section level2">
<h2><span class="header-section-number">2.4</span> Monthly Amount</h2>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="data-cleaning.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
